# Navigation数据集F1值优化指南

## 问题分析

根据训练日志分析，当前navigation数据集的F1值在47-62%之间波动，主要问题包括：

### 1. 性能瓶颈
- **高召回率，低精确率**：模型倾向于过度预测实体
- **实体类型不平衡**：某些实体类型样本过多，某些过少
- **文本长度较长**：navigation文本平均长度较长，需要更好的上下文理解
- **实体边界模糊**：军事专业术语的边界识别困难

### 2. 数据集特点
- **领域专业性**：军事导航与对抗相关，包含大量专业术语
- **实体多样性**：包含"对抗国家"、"硬摧毁武器"、"压制式干扰技术"等多种实体类型
- **文本复杂度**：技术文档风格，句子结构复杂

## 优化策略

### 1. 数据层面优化

#### 1.1 数据平衡
```bash
# 创建平衡数据集，减少高频实体类型的权重
python optimize_navigation_performance.py
```

#### 1.2 数据增强
- 创建部分实体版本，增加训练样本多样性
- 保持实体边界和语义一致性

#### 1.3 实体类型分析
- 统计各实体类型的分布情况
- 识别低频实体类型，针对性优化

### 2. 模型层面优化

#### 2.1 超参数调优
- **学习率**：从3e-5降低到1e-5，避免过拟合
- **批次大小**：从16降低到4，提高训练稳定性
- **最大序列长度**：从256增加到512，捕获更长上下文
- **最大span长度**：从6增加到8-10，适应更长实体

#### 2.2 正则化策略
- **Dropout**：增加model_dropout到0.4-0.5，bert_dropout到0.3-0.4
- **权重衰减**：增加到0.05-0.1，防止过拟合
- **负样本权重**：降低到0.2-0.3，平衡正负样本

#### 2.3 训练策略
- **早停**：增加到15-20轮，给模型更多收敛时间
- **学习率调度**：使用更长的warmup_steps（500-1000）
- **梯度裁剪**：启用梯度裁剪，提高训练稳定性

### 3. 集成学习策略

#### 3.1 多模型集成
- 训练3个不同配置的模型
- 使用不同的随机种子
- 采用不同的dropout和学习率

#### 3.2 投票策略
- 多数投票
- 加权F1投票
- Span分数投票

## 使用指南

### 快速开始

#### 1. 基础优化训练
```bash
# 运行基础优化训练
bash run_navigation_optimized.sh
```

#### 2. 超优化训练
```bash
# 如果基础优化效果不理想，运行超优化训练
bash run_navigation_super_optimized.sh
```

#### 3. 集成训练
```bash
# 训练多个模型进行集成
bash run_navigation_ensemble.sh
```

#### 4. 快速验证
```bash
# 快速验证优化效果
bash quick_validation.sh
```

### 参数说明

#### 核心优化参数
- `--batch_size 4`：小批次训练，提高稳定性
- `--lr 1e-5`：低学习率，避免过拟合
- `--max_spanLen 8`：增加最大span长度
- `--bert_max_length 512`：增加序列长度
- `--model_dropout 0.4`：增加dropout防止过拟合
- `--neg_span_weight 0.3`：降低负样本权重
- `--early_stop 15`：增加早停轮数

#### 高级参数
- `--warmup_steps 500`：更长的warmup
- `--weight_decay 0.05`：增加权重衰减
- `--polydecay_ratio 3`：调整学习率衰减
- `--use_span_weight True`：启用span权重
- `--classifier_sign multi_nonlinear`：使用非线性分类器

### 预期效果

#### 第一阶段：基础优化
- **目标**：F1值提升到55-65%
- **方法**：参数调优 + 数据平衡
- **时间**：2-3小时

#### 第二阶段：超优化
- **目标**：F1值提升到65-75%
- **方法**：更激进的参数 + 数据增强
- **时间**：4-6小时

#### 第三阶段：集成学习
- **目标**：F1值提升到70-80%
- **方法**：多模型集成 + 投票策略
- **时间**：8-12小时

## 监控指标

### 训练过程监控
1. **训练损失**：应该稳定下降
2. **验证F1**：主要优化目标
3. **过拟合检测**：训练F1与验证F1差距
4. **收敛速度**：F1值提升趋势

### 性能指标
- **精确率**：避免过度预测
- **召回率**：避免漏检
- **F1值**：综合性能指标
- **ECE**：校准误差

## 故障排除

### 常见问题

#### 1. 内存不足
```bash
# 解决方案：减少batch_size和序列长度
--batch_size 2
--bert_max_length 256
```

#### 2. 训练不收敛
```bash
# 解决方案：调整学习率和warmup
--lr 5e-6
--warmup_steps 1000
```

#### 3. 过拟合严重
```bash
# 解决方案：增加正则化
--model_dropout 0.6
--weight_decay 0.1
--early_stop 10
```

#### 4. 欠拟合
```bash
# 解决方案：减少正则化，增加模型容量
--model_dropout 0.2
--weight_decay 0.01
--iteration 300
```

### 调试技巧

1. **查看训练日志**：监控F1值变化趋势
2. **分析实体分布**：识别问题实体类型
3. **可视化结果**：绘制训练曲线
4. **对比实验**：不同参数配置的效果对比

## 最佳实践

### 1. 数据准备
- 确保数据集格式正确
- 检查实体标注质量
- 平衡各类实体分布

### 2. 训练策略
- 从简单配置开始
- 逐步增加复杂度
- 及时保存检查点

### 3. 评估方法
- 使用验证集调优
- 最终在测试集评估
- 分析错误案例

### 4. 模型选择
- 选择验证集最佳模型
- 考虑模型集成
- 平衡性能和效率

## 总结

通过系统性的优化策略，navigation数据集的F1值有望从当前的47-62%提升到60%以上。关键是要：

1. **理解数据特点**：军事专业领域的特殊性
2. **针对性优化**：根据问题调整参数
3. **系统性方法**：从数据到模型的全面优化
4. **持续监控**：及时调整优化策略

建议按照指南中的步骤逐步实施，每个阶段都要验证效果后再进入下一阶段。
